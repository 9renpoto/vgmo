---
import MainLayout from "../../layouts/MainLayout.astro";
import Card from "@vgmo/ui/src/Card";
import type { CardProps } from "@vgmo/ui/src/Card";
import type { ConcertWithMeta } from "../../utils/concerts";
export { getStaticPaths } from "../../utils/paths";

interface Props { concert: ConcertWithMeta }
const { concert } = Astro.props as Props;

const toCard = (c: ConcertWithMeta): CardProps => ({
  title: c.title,
  imageUrl: c.image,
  date: new Date(c.date).toLocaleDateString("ja-JP"),
  buttonText: "チケットサイトへ",
  buttonUrl: c.ticketUrl || "",
  sourceName: new URL(c.sourceUrl).hostname,
  sourceUrl: c.sourceUrl,
  prefectures: c.prefectures,
});

const site = import.meta.env.PUBLIC_SITE_URL ?? Astro.site?.origin ?? "";
const url = `${site}/concert/${concert.slug}`;
const description = concert.title;
---

<MainLayout title={concert.title}>
  <Fragment slot="head">
    <meta property="og:title" content={concert.title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="article" />
    <meta property="og:url" content={url} />
    <meta property="og:image" content={concert.image} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={concert.title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={concert.image} />
  </Fragment>

  <div class="space-y-4">
    <Card {...toCard(concert)} />
    <div class="mt-2 text-sm text-gray-700">
      <p>
        日時: <strong>{concert.date}</strong>
      </p>
      <p class="text-xs text-gray-500">
        ソース: <a class="underline" href={concert.sourceUrl} target="_blank" rel="noreferrer">{concert.sourceUrl}</a>
        {concert.ticketUrl && (
          <>
            {" | チケット: "}
            <a class="underline" href={concert.ticketUrl} target="_blank" rel="noreferrer">{concert.ticketUrl}</a>
          </>
        )}
      </p>
    </div>
  </div>
</MainLayout>
